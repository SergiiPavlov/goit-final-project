openapi: 3.0.3
info:
  title: Lehlehka API
  version: 0.8.0
  description: Backend API for Lehlehka (Next + Node) team project.
servers:
  - url: http://localhost:4000

tags:
  - name: system
    description: Service and environment endpoints.
  - name: auth
    description: Authentication (access+refresh) and sessions.
  - name: users
    description: User profile endpoints.
  - name: tasks
    description: Daily tasks (to-do) endpoints.
  - name: diaries
    description: Daily diary entries endpoints.
  - name: emotions
    description: Emotions reference endpoints (used by diary entries).
  - name: weeks
    description: Pregnancy weeks (baby development, mom state, and dashboard info).

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        code:
          type: string
        details:
          nullable: true
      required: [message]

    PublicUser:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        gender:
          type: string
          enum: [boy, girl]
          nullable: true
        dueDate:
          type: string
          format: date
          nullable: true
        avatarUrl:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, email, gender, dueDate, avatarUrl, createdAt, updatedAt]

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
      required: [accessToken, refreshToken]

    WeekBabyState:
      type: object
      properties:
        id: { type: string }
        weekNumber: { type: integer, minimum: 1, maximum: 40 }
        image: { type: string, nullable: true }
        babySize: { type: string, nullable: true }
        babyWeight: { type: string, nullable: true }
        analogy: { type: string, nullable: true }
        description: { type: string, nullable: true }
        babyActivities:
          type: array
          items: { type: string }
        momDailyTips:
          type: array
          items: { type: string }
      required: [id, weekNumber, babyActivities, momDailyTips]

    WeekMomState:
      type: object
      properties:
        id: { type: string }
        weekNumber: { type: integer, minimum: 1, maximum: 40 }
        image: { type: string, nullable: true }
        changes:
          type: array
          items: { type: string }
        comfortTips:
          type: array
          items:
            type: object
            properties:
              category: { type: string }
              tips:
                type: array
                items: { type: string }
            required: [category, tips]
      required: [id, weekNumber, changes, comfortTips]

    WeekDashboardInfo:
      type: object
      properties:
        weekNumber: { type: integer, minimum: 1, maximum: 40 }
        baby:
          type: object
          properties:
            weekNumber: { type: integer }
            image: { type: string, nullable: true }
            babySize: { type: string, nullable: true }
            babyWeight: { type: string, nullable: true }
            analogy: { type: string, nullable: true }
          required: [weekNumber]
        mom:
          type: object
          properties:
            weekNumber: { type: integer }
            image: { type: string, nullable: true }
            tip:
              nullable: true
              type: object
              properties:
                category: { type: string }
                tip: { type: string }
              required: [category, tip]
          required: [weekNumber]
        momDailyTip:
          type: string
          nullable: true
      required: [weekNumber, baby, mom, momDailyTip]

    CurrentWeekResponse:
      type: object
      properties:
        weekNumber: { type: integer, minimum: 1, maximum: 40 }
        daysToChildbirth: { type: integer, minimum: 0 }
        dashboard:
          $ref: '#/components/schemas/WeekDashboardInfo'
      required: [weekNumber, daysToChildbirth, dashboard]

    RegisterRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 32
        email:
          type: string
          format: email
          maxLength: 64
        password:
          type: string
          minLength: 8
          maxLength: 128
        gender:
          type: string
          enum: [boy, girl]
          nullable: true
        dueDate:
          type: string
          format: date
          nullable: true
      required: [name, email, password]

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          maxLength: 64
        password:
          type: string
          minLength: 8
          maxLength: 128
      required: [email, password]

    RefreshRequest:
      type: object
      properties:
        refreshToken:
          type: string
      required: [refreshToken]

    LogoutRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Optional; if provided, invalidates only that session.

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 32
        gender:
          type: string
          enum: [boy, girl]
          nullable: true
        dueDate:
          type: string
          format: date
          nullable: true
      additionalProperties: false

    AuthResponse:
      allOf:
        - type: object
          properties:
            user:
              $ref: '#/components/schemas/PublicUser'
          required: [user]
        - $ref: '#/components/schemas/AuthTokens'

    Task:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        name:
          type: string
        date:
          type: string
          format: date
        isDone:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, userId, name, date, isDone, createdAt, updatedAt]

    CreateTaskRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 96
        date:
          type: string
          format: date
          description: YYYY-MM-DD
        isDone:
          type: boolean
          default: false
      required: [name, date]

    UpdateTaskStatusRequest:
      type: object
      properties:
        isDone:
          type: boolean
      required: [isDone]

    TaskListResponse:
      type: object
      properties:
        date:
          type: string
          format: date
        tasks:
          type: array
          items:
            $ref: '#/components/schemas/Task'
      required: [date, tasks]

    EmotionRef:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
      required: [id, title]

    DiaryEntry:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        title:
          type: string
        description:
          type: string
        date:
          type: string
          format: date
        emotions:
          type: array
          items:
            $ref: '#/components/schemas/EmotionRef'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, userId, title, description, date, emotions, createdAt, updatedAt]

    CreateDiaryRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 64
        description:
          type: string
          minLength: 1
          maxLength: 1000
        date:
          type: string
          format: date
          description: YYYY-MM-DD (optional, defaults to today)
        emotions:
          type: array
          minItems: 1
          maxItems: 12
          items:
            type: string
      required: [title, description, emotions]

    UpdateDiaryRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 64
        description:
          type: string
          minLength: 1
          maxLength: 1000
        date:
          type: string
          format: date
          description: YYYY-MM-DD
        emotions:
          type: array
          minItems: 1
          maxItems: 12
          items:
            type: string
      additionalProperties: false

    DiaryListResponse:
      type: object
      properties:
        date:
          type: string
          format: date
        entries:
          type: array
          items:
            $ref: '#/components/schemas/DiaryEntry'
      required: [date, entries]

paths:
  /health:
    get:
      tags: [system]
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  ts:
                    type: string
                    format: date-time
                required: [ok, ts]

  /health/db:
    get:
      tags: [system]
      summary: Database health check
      description: Verifies database connectivity.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required: [ok]
        '500':
          description: Database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/register:
    post:
      tags: [auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Email already in use
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      tags: [auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      tags: [auth]
      summary: Refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      tags: [auth]
      summary: Logout (invalidate session(s))
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  scope:
                    type: string
                    enum: [single, all]
                required: [ok, scope]
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/current:
    get:
      tags: [users]
      summary: Get current user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicUser'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users:
    patch:
      tags: [users]
      summary: Update current user profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicUser'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/avatar:
    patch:
      tags: [users]
      summary: Upload current user avatar
      description: Upload avatar image via multipart/form-data. Field name is `avatar`.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [avatar]
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicUser'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/tasks:
    get:
      tags: [tasks]
      summary: Get tasks for a date (defaults to today)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: date
          schema:
            type: string
            format: date
          description: YYYY-MM-DD
      responses:
        '200':
          description: Tasks list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskListResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags: [tasks]
      summary: Create task
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/tasks/{id}:
    patch:
      tags: [tasks]
      summary: Change task status
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskStatusRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/emotions:
    get:
      tags: [emotions]
      summary: List emotions
      description: Public reference list of emotions for diary entries.
      responses:
        '200':
          description: Emotions list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EmotionRef'

  /api/emotions/{id}:
    get:
      tags: [emotions]
      summary: Get emotion by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Emotion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmotionRef'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/diaries:
    get:
      tags: [diaries]
      summary: Get diary entries for a date (defaults to today)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: date
          schema:
            type: string
            format: date
          description: YYYY-MM-DD
      responses:
        '200':
          description: Diary entries list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiaryListResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags: [diaries]
      summary: Create diary entry
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDiaryRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiaryEntry'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/diaries/{id}:
    patch:
      tags: [diaries]
      summary: Update diary entry
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDiaryRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiaryEntry'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/weeks/{weekNumber}:
    get:
      tags: [weeks]
      summary: Get week dashboard info (public)
      parameters:
        - in: path
          name: weekNumber
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 40
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeekDashboardInfo'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/weeks/current:
    get:
      tags: [weeks]
      summary: Get current week and dashboard info for authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeekCurrentInfo'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/weeks/{weekNumber}/baby:
    get:
      tags: [weeks]
      summary: Getetrieve baby development by week (private)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: weekNumber
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 40
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeekBabyState'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/weeks/{weekNumber}/mom:
    get:
      tags: [weeks]
      summary: Retrieve mom body state by week (private)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: weekNumber
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 40
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeekMomState'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
